<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="../css/register.css" />
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
	crossorigin="anonymous"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>

<style type="text/css">
.email_Ok {
	color: #008000;
	display: none;
}

.email_Already {
	color: #6A82FB;
	display: none;
}

.nickname_Ok {
	color: #008000;
	display: none;
}

.nickname_Already {
	color: red;
	display: none;
}
#emailspan{
	display: none;
	
}
#email{
	background: white;
}
#numOk{
	display: none;
}


</style>
<script>
	$(function() {
		var code = "";
		$("#repw").on("blur", function() {
			var pw = $("#pw").val();
			var repw = $("#repw").val();

			if (pw != repw) {
				$("#nopw").text("비밀번호가 일치하지 않습니다.");
			} else {
				$("#nopw").text("");
			}
		});

		$("#emailList").on("change", function() {
			$("#email2").val($("#emailList").val());
		});

		$("#emailCk").on("click", function() {
			var email1 = $('#email1').val();
			var email2 = $('#email2').val();
			var email = email1 + "@" + email2;
			if(email1 == "" || email2 == ""){
				alert("이메일 형식에 맞게 기재해주세요")
			}else{
				console.log(email);
			
				
				$.ajax({
					url : '../member/emailCheck',
					type : 'post',
					data : {
						email : email
					},
					success : function(cnt) { //컨트롤러에서 넘어온 cnt값을 받는다 
						if (cnt == 0) { //cnt가 1이 아니면(=0일 경우) -> 사용 가능한 아이디 
							$(".email_Ok").css("display","inline-block");
							$(".email_Already").css("display","none");
							$("#emailspan").css("display","inline-block");
							$("#email").val(email);
						}else { // cnt가 1일 경우 -> 이미 존재하는 아이디
							$(".email_Ok").css("display","none");
							$(".email_Already").css("display","inline-block");
							$("#email1").val('');
							$("#email2").val('');
							alert("아이디를 다시 입력해주세요.");
						}
					},
					error:function(){
						alert("에러입니다.");
					}
				}); 
			}
		});
		
		$("#nickname").on("blur", function(){
			var nickname = $("#nickname").val();
			$.ajax({
				url : '/member/nicknameCheck',
				type : 'post',
				data : {nickname : nickname},
				success:function(cnt){
					if(cnt == 0){
						$(".nickname_Ok").css("display","inline-block");
						$(".nickname_Already").css("display","none");
					}else{
						$(".nickname_Ok").css("display","none");
						$(".nickname_Already").css("display","inline-block");
						$("#nickname").val('');
						alert("아이디를 다시 입력해주세요.");
					}
				},
				error:function(){
					alert("에러입니다.");
				}
			});
		});
		
		$("#checknum").on("click", function(){
			var email = $("#email").val();
			if(email != ""){
				/* console.log("클릭"); */
				$.ajax({
					type : 'post',
					url : '/account/mailConfirm',
					data : { "email" : email },
					success : function (data) {
						console.log("data : " +  data);
						/* checkInput.attr('disabled',false); */
						code =data;
						alert('인증번호가 전송되었습니다.');
						$("#numOk").css("display","inline-block");
					}			
				});
			}
		});
		
		$("#numOkButton").on("click", function(){
			var email = $("#email").val();
				console.log("클릭");
				if (code != $("#memailconfirm").val()) { 
					emconfirmchk = false;
					$("#memailconfirmTxt").html("<span id='emconfirmchk'>인증번호가 잘못되었습니다</span>")
					$("#emconfirmchk").css({
						"color" : "#FA3E3E",
						"font-weight" : "bold",
						"font-size" : "10px"

					})
					//console.log("중복아이디");
				} else { // 아니면 중복아님
					emconfirmchk = true;
					$("#memailconfirmTxt").html("<span id='emconfirmchk'>인증번호 확인 완료</span>")

					$("#emconfirmchk").css({
						"color" : "#0D6EFD",
						"font-weight" : "bold",
						"font-size" : "10px"

					})
				}
		});
		
	});
	
	
</script>
</head>
<body>
	<div class="title">
		<h1>WEGOING</h1>
	</div>
	<div class="register-form">
		<form action="/wegoing/register" method="post">
			<table id="register-table">

				<tr>
					<th class="th-title">이메일</th>
					<td>
					<input type="text" name="email1" id="email1" class="text"
						size="11" />@ <input type="text" name="email2" id="email2"
						class="text" size="11" /> <select name="emailList" id="emailList">
							<option value="">직접입력</option>
							<option value="daum.net">daum.net</option>
							<option value="google.com">google.com</option>
					</select>
						<button type="button" id="emailCk" class="btn btn-dark">중복검사</button>
						<p>
							<span class="email_Ok">사용 가능한 아이디입니다.</span>
							<span class="email_Already">누군가 이 아이디를 사용하고 있어요.</span>
						</p>
					</td>
				</tr>
				<tr>
					<th>이름</th>
					<td><input type="text" name="name" id="name" class="text"
						size="7" /></td>
				<tr>
				<tr>
					<th>닉네임</th>
					<td>
						<input type="text" name="nickname" id="nickname"
						class="text" size="7" />
						<p>
							<span class="nickname_Ok">사용 가능한 닉네임입니다.</span>
							<span class="nickname_Already">누군가 사용하고있는 닉네임이에요.</span>
						</p>
					</td>
				<tr>
				<tr>
					<th>비밀번호</th>
					<td><input type="password" name="pw" id="pw" class="text"
						size="20" /></td>
				<tr>
					<th>비밀번호 재확인</th>
					<td><input type="password" name="repw" id="repw" class="text"
						size="20" />
						<p>
							<span id="nopw"></span>
						</p></td>
				</tr>
				<tr>
					<th>휴대전화</th>
					<td><input type="text" name="mp" id="" class="text"
						placeholder="010-xxxx-xxxx" size="15" /></td>
				</tr>
				<tr>
					<th rowspan="2">이메일 인증</th>
					<td>
					<!-- <input type="text" name="email" id="email" class="text" value="" size="15" /> -->
					<span id="emailspan"><input type="text" name="email" id="email" disabled="disabled" value="" /></span>
					<button type="button" id="checknum" class="btn btn-dark" >인증번호 받기</button>
					</td>
				</tr>
				<tr>
					<td>
						<input type="hidden" name="" />
						<span id="numOk">
						<label for="memailconfirm" id="memailconfirmTxt">인증번호를 입력해주세요</label> 
						<input type="text" name="memailconfirm" id="memailconfirm" placeholder="인증번호 6자리를 입력해주세요!" size="30" class="text" />
						<button type="button" id="numOkButton" class="btn btn-dark">인증 확인</button></span>
					</td>
				</tr>
				

				<tr>
					<td colspan="2" class="btn-box"><input type="submit"
						value="가입하기" class="btn btn-outline-success" /> <a
						th:href="@{/wegoing/main}"> <input type="button" value="돌아가기"
							class="btn btn-outline-success" />
					</a></td>
				</tr>
			</table>
		</form>
	</div>

</body>
</html>